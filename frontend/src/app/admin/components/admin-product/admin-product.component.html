<div class="admin-product-container">
  <!-- Notification Message -->
  <div class="notification-wrapper" *ngIf="showMessage">
    <div class="notification {{messageType}}">
      <div class="notification-content">
        <i class="icon" [ngClass]="{
          'fas fa-check-circle': messageType === 'success',
          'fas fa-exclamation-circle': messageType === 'error',
          'fas fa-info-circle': messageType === 'info'
        }"></i>
        <span>{{message}}</span>
      </div>
      <div class="progress-bar" *ngIf="messageType === 'info'">
        <div class="progress" [style.width.%]="progressValue"></div>
      </div>
      <button class="close-btn" (click)="hideMessage()">
        <i class="fas fa-times"></i>
      </button>
    </div>
  </div>

  <div class="header-actions">
    <!-- Show Deleted Products Button - appears only when isDeletedView = false -->
    <button class="toggle-view-btn" (click)="showDeletedProducts()" *ngIf="!isDeletedView">
      <i class="fas fa-eye-slash"></i>
      View Deleted Products
    </button>

    <!-- Show Active Products Button - appears only when isDeletedView = true -->
    <button class="toggle-view-btn" (click)="showActiveProducts()" *ngIf="isDeletedView">
      <i class="fas fa-eye"></i>
      View Active Products
    </button>

    <button class="create-btn" (click)="isCreating = true" *ngIf="!isEdit && !isDeletedView">
      <i class="fas fa-plus"></i> Create New Product
    </button>
  </div>

  <!-- Product Form -->
  <div class="form-section" *ngIf="isEdit || isCreating">
    <h2>{{ isEdit ? 'Edit Product' : 'Create Product' }}</h2>
    <form [formGroup]="form" (ngSubmit)="submitForm()" class="product-form">
      <div class="form-group">
        <label for="productName">Product Name *</label>
        <input type="text" id="productName" formControlName="productName" class="form-input">
        <span class="error-message" *ngIf="form.get('productName')?.invalid && form.get('productName')?.touched">
          Product name is required
        </span>
      </div>

      <div class="form-group">
        <label for="collectionsSlug">Collection *</label>
        <select id="collectionsSlug" formControlName="collectionsSlug" class="form-input">
          <option value="">Select Collection</option>
          <option *ngFor="let col of collections" [value]="col.collectionSlug">
            {{ col.collectionName }}
          </option>
        </select>
        <span class="error-message" *ngIf="form.get('collectionsSlug')?.invalid && form.get('collectionsSlug')?.touched">
          Collection is required
        </span>
      </div>




      <div class="form-row">
        <div class="form-group">
          <label for="price">Price *</label>
          <input type="number" id="price" formControlName="price" class="form-input" min="0">
          <span class="error-message" *ngIf="form.get('price')?.invalid && form.get('price')?.touched">
            Valid price is required
          </span>
        </div>


              <div class="form-group">
  <label for="description">Description </label>
  <textarea id="description" formControlName="description" class="form-input" rows="3"></textarea>
  <span class="error-message" *ngIf="form.get('description')?.invalid && form.get('description')?.touched">
    Description is required
  </span>
</div>
        <div class="form-group">
          <label for="quantity">Quantity *</label>
          <input type="number" id="quantity" formControlName="quantity" class="form-input" min="0">
          <span class="error-message" *ngIf="form.get('quantity')?.invalid && form.get('quantity')?.touched">
            Valid quantity is required
          </span>
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="gender">Gender *</label>
          <select id="gender" formControlName="gender" class="form-input">
            <option value="unisex">Unisex</option>
            <option value="male">Male</option>
            <option value="female">Female</option>
          </select>
        </div>

        <div class="form-group">
          <label for="stockAlertThreshold">Stock Alert *</label>
          <input type="number" id="stockAlertThreshold" formControlName="stockAlertThreshold" class="form-input" min="0">
          <span class="error-message" *ngIf="form.get('stockAlertThreshold')?.invalid && form.get('stockAlertThreshold')?.touched">
            Valid threshold is required
          </span>
        </div>
      </div>

      <div class="form-group">
        <label>Product Images</label>
        <div class="file-upload-wrapper">
          <label for="productImages" class="file-upload-label">
            <i class="fas fa-cloud-upload-alt"></i>
            <span>Choose Images</span>
            <input type="file" id="productImages" (change)="handleImageChange($event)" multiple accept="image/*">
          </label>
        </div>
        <div class="image-preview-grid">
          <div class="image-preview-item" *ngFor="let img of previewImages">
            <img [src]="img" alt="Product preview">
            <button type="button" class="remove-image-btn" (click)="removeImage(img)">
              <i class="fas fa-times"></i>
            </button>
          </div>
        </div>
      </div>

      <div class="form-actions">
        <button type="submit" class="submit-btn" [disabled]="form.invalid">
          <i class="fas" [class.fa-save]="isEdit" [class.fa-plus]="!isEdit"></i>
          {{ isEdit ? 'Update' : 'Create' }}
        </button>
        <button type="button" (click)="resetForm()" class="cancel-btn">
          <i class="fas fa-times"></i> Cancel
        </button>
      </div>
    </form>
  </div>

  <!-- Products Table -->
  <div class="products-table">
    <div class="table-responsive">
      <table>
        <thead>
          <tr>
            <th>Name</th>
            <th>Collection</th>
            <th>Price</th>
            <th>Description</th>

            <th>Qty</th>
            <th>Gender</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let prod of products">
            <td>{{ prod.productName }}</td>
            <td>{{ prod.collectionId?.collectionsName }}</td>
            <td>{{ prod.price | currency }}</td>
            <td>{{ prod.description }}</td>
            <td [class.low-stock]="prod.quantity <= prod.stockAlertThreshold">{{ prod.quantity }}</td>
            <td>{{ prod.gender | titlecase }}</td>
            <td class="actions">
              <button (click)="editProduct(prod)" class="edit-btn" title="Edit" *ngIf="!isDeletedView">
                <i class="fas fa-edit"></i>
              </button>
              <button 
                (click)="isDeletedView ? restoreProduct(prod.productSlug) : deleteProduct(prod.productSlug)" 
                class="action-btn"
                [class.delete-btn]="!isDeletedView"
                [class.restore-btn]="isDeletedView"
                [title]="isDeletedView ? 'Restore' : 'Delete'">
                <i [class]="isDeletedView ? 'fas fa-trash-restore' : 'fas fa-trash'"></i>
              </button>
            </td>
          </tr>
          <tr *ngIf="products.length === 0">
            <td colspan="6" class="empty-table">
              <i class="fas fa-box-open"></i>
              <p>No {{isDeletedView ? 'deleted' : ''}} products found</p>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <div class="pagination" *ngIf="totalPages > 1">
      <button (click)="goToPage(page - 1)" [disabled]="page === 1" class="pagination-btn">
        <i class="fas fa-chevron-left"></i> Previous
      </button>
      <span class="page-info">Page {{ page }} of {{ totalPages }}</span>
      <button (click)="goToPage(page + 1)" [disabled]="page === totalPages" class="pagination-btn">
        Next <i class="fas fa-chevron-right"></i>
      </button>
    </div>
  </div>
</div>