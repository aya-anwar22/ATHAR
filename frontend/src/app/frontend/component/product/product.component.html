<div class="product-container">
  <!-- Alert Messages -->
  <div *ngIf="showSuccessAlert" class="alert alert-success alert-dismissible fade show fixed-top m-3" role="alert">
    {{ alertMessage }}
    <button type="button" class="btn-close" (click)="showSuccessAlert = false" aria-label="Close"></button>
  </div>

  <div *ngIf="showErrorAlert" class="alert alert-danger alert-dismissible fade show fixed-top m-3" role="alert">
    {{ alertMessage }}
    <button type="button" class="btn-close" (click)="showErrorAlert = false" aria-label="Close"></button>
  </div>

  <!-- Loading State -->
  <div *ngIf="isLoading" class="text-center py-5">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Loading...</span>
    </div>
    <p class="mt-2">Loading products...</p>
  </div>

  <!-- Error State -->
  <div *ngIf="errorMessage && !isLoading" class="alert alert-danger text-center my-5">
    {{ errorMessage }}
    <button class="btn btn-sm btn-outline-secondary ms-3" (click)="loadProducts(currentCategory || undefined)">
      Retry
    </button>
  </div>

  <!-- Content -->
  <div *ngIf="!isLoading && !errorMessage" class="row g-4">
    <!-- Subcategories Sidebar -->
    <div class="col-lg-3" *ngIf="subcategories.length > 0">
      <div class="card sidebar-card">
        <div class="card-header bg-primary text-white">
          <h5 class="mb-0">Subcategories</h5>
        </div>
        <div class="list-group list-group-flush">
          <a
            *ngFor="let sub of subcategories; trackBy: trackBySubcategoryId"
            class="list-group-item list-group-item-action d-flex align-items-center"
            [routerLink]="['/sub-category', sub._id]"
            routerLinkActive="active"
          >
            <img
              [src]="sub.subcategoryImage"
              [alt]="sub.subcategoryName"
              width="40"
              height="40"
              class="me-3 rounded-circle object-fit-cover"
              (error)="handleImageError($event)"
            />
            <span class="fw-medium">{{ sub.subcategoryName }}</span>
          </a>
        </div>
      </div>
    </div>

    <!-- Products Main Content -->
    <div [class.col-lg-9]="subcategories.length > 0" [class.col-12]="subcategories.length === 0">
      <div class="d-flex justify-content-between align-items-center mb-4">
        <h2 class="mb-0">
          {{ currentCategory ? 'Category Products' : 'All Products' }}
        </h2>
        <span class="badge bg-secondary">{{ products.length }} products</span>
      </div>

      <!-- Products Grid -->
      <div *ngIf="products.length > 0" class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
        <div *ngFor="let product of products; trackBy: trackByProductId" class="col">
          <div class="card product-card h-100">
     
            <div class="product-image-container">
              <img
                [src]="product.productImages[0] || '/assets/images/placeholder.png'"
                class="card-img-top"
                [alt]="product.productName"
                (error)="handleImageError($event)"
              />
            </div>
            <div class="card-body">
              <h5 class="card-title text-truncate">{{ product.productName }}</h5>
              
      
              
              <div class="d-flex justify-content-between align-items-center mb-3">
                <span class="badge bg-info">{{ product.gender }}</span>
                <span class="small" [ngClass]="{
                  'text-success': product.quantity > 5,
                  'text-warning': product.quantity > 0 && product.quantity <= 5,
                  'text-danger': product.quantity === 0
                }">
                  {{ product.quantity > 0 ? (product.quantity + ' available') : 'Out of stock' }}
                </span>
              </div>

              <div class="d-flex justify-content-between gap-2">
                <a
                  [routerLink]="['/product', product._id]"
                  class="btn btn-outline-primary btn-sm flex-grow-1"
                >
                  <i class="bi bi-eye-fill me-1"></i> Details
                </a>
                <button
                  class="btn btn-success btn-sm flex-grow-1"
                  (click)="addToCart(product)"
                  [disabled]="product.quantity === 0"
                >
                  <i class="bi bi-cart-plus me-1"></i> Add
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Empty State -->
      <div *ngIf="products.length === 0" class="text-center py-5">
        <img src="/assets/images/empty-state.svg" alt="No products" width="200" class="mb-4">
        <h4 class="text-muted">No products found</h4>
        <p class="text-muted">There are currently no products available in this category</p>
        <button class="btn btn-primary" [routerLink]="['/products']">
          Browse All Products
        </button>
      </div>
    </div>
  </div>
</div>